<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Pipeline | Lage</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://microsoft.github.io/lage/docs-new/docs/Guide/pipeline"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Pipeline | Lage"><meta data-react-helmet="true" name="description" content="In the traditional monorepo task runners, like lerna, each npm lifecycle script like build or test is run topologically or in parallel individually. Depending on the graph of the packages, CPU cores are left idle wasting developer time."><meta data-react-helmet="true" property="og:description" content="In the traditional monorepo task runners, like lerna, each npm lifecycle script like build or test is run topologically or in parallel individually. Depending on the graph of the packages, CPU cores are left idle wasting developer time."><link data-react-helmet="true" rel="icon" href="/lage/docs-new/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://microsoft.github.io/lage/docs-new/docs/Guide/pipeline"><link data-react-helmet="true" rel="alternate" href="https://microsoft.github.io/lage/docs-new/docs/Guide/pipeline" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://microsoft.github.io/lage/docs-new/docs/Guide/pipeline" hreflang="x-default"><link rel="stylesheet" href="/lage/docs-new/assets/css/styles.a8d823c8.css">
<link rel="preload" href="/lage/docs-new/assets/js/runtime~main.42ede201.js" as="script">
<link rel="preload" href="/lage/docs-new/assets/js/main.ec741530.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/lage/docs-new/"><b class="navbar__title">Lage</b></a><a class="navbar__item navbar__link navbar__link--active" href="/lage/docs-new/docs/Introducing Lage/Overview">Guide</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/microsoft/lage" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/lage/docs-new/docs/Introducing Lage/Overview">Introducing Lage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_TwRn" href="/lage/docs-new/docs/Guide/">Guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs-new/docs/Guide/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs-new/docs/Guide/levels">How does `lage` work?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs-new/docs/Guide/scopes">Scoped builds</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs-new/docs/Guide/cache">Caching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs-new/docs/Guide/remote-cache">Remote Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/lage/docs-new/docs/Guide/pipeline">Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs-new/docs/Guide/profile">Profiling `lage`</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs-new/docs/Guide/priority">Priorities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs-new/docs/Guide/config">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs-new/docs/Guide/cli">CLI usage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lage/docs-new/docs/Guide/migration">Migration Guide</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/lage/docs-new/docs/Contributing/contribution-guide">Contributing</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Pipelining package tasks</h1></header><p>In the traditional monorepo task runners, like <code>lerna</code>, each npm lifecycle script like <code>build</code> or <code>test</code> is run topologically or in parallel individually. Depending on the graph of the packages, CPU cores are left idle wasting developer time.</p><p>Futhermore, the developer is expected to keep track of an <strong>implicit</strong> graph of the tasks. For example, the developer is expected to understand that perhaps the <code>test</code> task is only available after <code>build</code> has completed.</p><p><code>lage</code> gives developers a way to specify these relationships <strong>explicitly</strong>. The advantage here are two fold. First, incoming new developers can look at <code>lage.config.js</code> and understand how tasks are related. Second, <code>lage</code> can use this explicit declaration to perform an optimized build based on the abundant availability of multi-core processors.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="defining-a-pipeline">Defining a pipeline<a class="hash-link" href="#defining-a-pipeline" title="Direct link to heading">​</a></h2><p>To define the task dependency graph, use the <code>pipeline</code> key in the <code>lage.config.js</code>. For example, this is the default generated configuration when you run <code>npx lage init</code>:</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  pipeline</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    build</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;^build&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;build&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lint</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="task-dependency-format">Task dependency format<a class="hash-link" href="#task-dependency-format" title="Direct link to heading">​</a></h3><p>What you are declaring here in the <code>pipeline</code> object of the configuration is a dependency graph of tasks. The <code>test</code> task above depends on the <code>build</code> task of the same package. The dependencies of <code>test</code> is an array, so it actually can depend on multiple tasks. This may be more relevant in a more complex monorepo.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="topological-dependency">Topological dependency<a class="hash-link" href="#topological-dependency" title="Direct link to heading">​</a></h3><p>The <code>^</code> symbol explicitly declares that the task has a package-topological dependency on another task. For example, if <code>foo</code> package depends on <code>bar</code>, <code>lage build</code> will guarantee that the <code>build</code> task of <code>bar</code> will happen before <code>foo</code>&#x27;s <code>build</code> task.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="empty-dependency-list">Empty dependency list<a class="hash-link" href="#empty-dependency-list" title="Direct link to heading">​</a></h3><p>The <code>lint</code> task above has NO dependencies. This means that it can start whenever it can!</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="tasks-that-are-in-the-pipeline-but-not-in-some-packagejson">Tasks that are in the <code>pipeline</code> but not in SOME <code>package.json</code><a class="hash-link" href="#tasks-that-are-in-the-pipeline-but-not-in-some-packagejson" title="Direct link to heading">​</a></h3><p>Sometimes tasks declared in the <code>pipeline</code> are not present in all packages&#x27; <code>package.json</code> files. <code>lage</code> will automatically ignore those. No problem!</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="pipeline-tasks-are-the-only-ones-that-lage-knows-about">Pipeline tasks are the only ones that <code>lage</code> knows about<a class="hash-link" href="#pipeline-tasks-are-the-only-ones-that-lage-knows-about" title="Direct link to heading">​</a></h3><p><code>lage</code> will only account for tasks declared in the <code>pipeline</code> configuration. If it&#x27;s not listed there, <code>lage</code> will not know how to run them.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="specific-package-tasks">Specific package tasks<a class="hash-link" href="#specific-package-tasks" title="Direct link to heading">​</a></h3><p>Sometimes it becomes necessary to manually place a package-task dependency on another package-task. This can occur especially in repos that are just coming off of a lerna or rush repository where the tasks are traditionally run in separate phases. Sometimes assumptions were made those repositories that are not expressable in the simple task pipeline configuration as seen above. For thoes cases, simply place those alongside with the rest of the pipeline configuration like this:</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  pipeline</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    build</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;^build&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;build&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    lint</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;foo#build&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;bar#test&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In this example, we illustrate a <code>build</code> script of <code>foo</code> package depends on the <code>test</code> script of <code>bar</code>. The syntax is <code>[package]#[task]</code>.</p><p>This seems like it goes against the <code>test: [&quot;build&quot;]</code>, but it does not. Since <code>test</code> scripts does not have a topological dependency, it theoretically can get triggered anytime its own package&#x27;s <code>build</code> script has finished! The general guidance is to get rid of these specific package-task to package-task dependency in the pipeline as quickly as possible so the builds can be optimized better.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/microsoft/lage/docs-new/docs/Guide/pipeline.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/lage/docs-new/docs/Guide/remote-cache"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Remote Cache</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/lage/docs-new/docs/Guide/profile"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Profiling `lage`</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#defining-a-pipeline" class="table-of-contents__link toc-highlight">Defining a pipeline</a><ul><li><a href="#task-dependency-format" class="table-of-contents__link toc-highlight">Task dependency format</a></li><li><a href="#topological-dependency" class="table-of-contents__link toc-highlight">Topological dependency</a></li><li><a href="#empty-dependency-list" class="table-of-contents__link toc-highlight">Empty dependency list</a></li><li><a href="#tasks-that-are-in-the-pipeline-but-not-in-some-packagejson" class="table-of-contents__link toc-highlight">Tasks that are in the <code>pipeline</code> but not in SOME <code>package.json</code></a></li><li><a href="#pipeline-tasks-are-the-only-ones-that-lage-knows-about" class="table-of-contents__link toc-highlight">Pipeline tasks are the only ones that <code>lage</code> knows about</a></li><li><a href="#specific-package-tasks" class="table-of-contents__link toc-highlight">Specific package tasks</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/lage/docs-new/docs/Contributing/contribution-guide">Contributing to Lage</a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/lage/docs-new/assets/js/runtime~main.42ede201.js"></script>
<script src="/lage/docs-new/assets/js/main.ec741530.js"></script>
</body>
</html>